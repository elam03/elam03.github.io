<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="stylesheet" href="assets/highlight/styles/default.css">
        <link rel="stylesheet" href="css/style.css">

        <script src="gen/main.js"></script>
        <script src="assets/highlight/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>

        <script src="https://satori-a.akamaihd.net/satori-sdk-js/v1.0.1/sdk.min.js"></script>
        <!-- <script src="https://satori-a.akamaihd.net/satori-sdk-js/v1.0.1/sdk.js"></script> -->
    </head>

    <body>
        <script>
            Elm.Main.fullscreen();

            ////////////////////////////////////
            // var RTM = require('..');

            var endpoint = 'wss://tjpallio.api.satori.com';
            var appkey = 'ECdF2dD99f6ee1eF6dA0e1fc894712bb';

            var rtm = new RTM(endpoint, appkey);

            rtm.on('enter-connected', function () {
                console.log('Connected to RTM!');
            });

            var channel = rtm.subscribe('test-channel', RTM.SubscriptionMode.SIMPLE);

            /* set callback for state transition */
            channel.on('enter-subscribed', function () {
                console.log('Subscribed to: ' + channel.subscriptionId);
            });

            /* set callback for PDU with specific action */
            channel.on('rtm/subscription/data', function (pdu) {
                pdu.body.messages.forEach(function (userData) {
                    console.log('Got message: ' + userData);
                    console.log('Got message: test: ' + userData.test);
                });
            });

            /* set callback for all subscription PDUs */
            channel.on('data', function (pdu) {
                if (pdu.action.endsWith('/error')) {
                    console.log('Subscription is failed: ', pdu.body);
                }
            });

            rtm.start();

            ////////////////////////////////////
        </script>
    </body>
</html>
